<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Calculadora do Contador — Simuladores Tributários</title>
  <meta name="description" content="Apuração mensal, ISS do Simples, Reforma Tributária, Parcelamento do Simples e Cálculos Trabalhistas. Login com 3 simulações grátis e planos pagos."/>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- jsPDF -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <!-- SheetJS -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    :root{ color-scheme: light; }
    html{ scroll-behavior:smooth; }
    .card{ background:#fff; border-radius:1rem; box-shadow:0 10px 20px rgba(0,0,0,.06); padding:1.25rem }
    .kpi{ display:flex; gap:.5rem; align-items:baseline; padding:.5rem .75rem; border:1px solid #e5e7eb; border-radius:.75rem; background:#f9fafb }
    .kpi .label{ font-size:.8rem; color:#6b7280 }
    .kpi .value{ font-weight:600 }
    .muted{ color:#6b7280 }
    .reveal{opacity:0; transform: translateY(16px); transition: opacity .6s ease, transform .6s ease;}
    .reveal.show{opacity:1; transform: translateY(0)}
    .nav-underline{ position:absolute; bottom:0; height:2px; background:rgb(37,99,235); border-radius:2px; transition: left .25s ease, width .25s ease; }
    #curtain{ position:fixed; inset:0; background:white; opacity:0; pointer-events:none; transition:opacity .22s ease; z-index:60; }
    #curtain.show{ opacity:1; pointer-events:auto; }
    .floaty{ animation: floaty 6s ease-in-out infinite; }
    @keyframes floaty{ 0%{transform:translateY(0)} 50%{transform:translateY(-6px)} 100%{transform:translateY(0)} }

    /* Marca d’água (logo no fundo) */
    .wm{
      position:relative;
      overflow:hidden;
    }
    .wm::before{
      content:"";
      position:absolute;
      inset:auto auto -40px -40px;
      width:520px; height:520px;
      background: radial-gradient(closest-side, rgba(59,130,246,.06), transparent 70%);
      filter: blur(0.5px);
      pointer-events:none;
      z-index:0;
    }
    .wm svg{
      position:absolute;
      top:-30px; left:-20px;
      width:420px; height:auto;
      opacity:.07;
      filter: drop-shadow(0 8px 30px rgba(0,0,0,.08));
      pointer-events:none;
      z-index:0;
    }
    .wm > *:not(svg){ position:relative; z-index:1; }

    /* Animação de gradiente no título */
    .shine{
      background-image: linear-gradient(90deg, #2563eb, #10b981, #2563eb);
      background-size: 200% 100%;
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      animation: shine 8s ease-in-out infinite;
    }
    @keyframes shine{
      0%{ background-position: 0% 50%; }
      50%{ background-position: 100% 50%; }
      100%{ background-position: 0% 50%; }
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-900">
  <div id="curtain" aria-hidden="true"></div>

  <!-- HEADER -->
  <header class="bg-white/80 backdrop-blur sticky top-0 z-30 border-b">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex items-center justify-between">
      <a href="#/" class="flex items-center gap-4" data-nav>
        <!-- LOGO NOVA: sem fundo, maior -->
        <svg width="72" height="72" viewBox="0 0 128 128" class="shrink-0">
          <defs>
            <linearGradient id="lg" x1="0" x2="1" y1="0" y2="1">
              <stop offset="0%" stop-color="#2563eb"/><stop offset="100%" stop-color="#10b981"/>
            </linearGradient>
          </defs>
          <!-- Monograma C² estilizado, sem retângulo de fundo -->
          <path d="M90 40a30 30 0 1 0 0 48" fill="none" stroke="url(#lg)" stroke-width="12" stroke-linecap="round"/>
          <path d="M68 24c18 0 28 10 28 10" fill="none" stroke="url(#lg)" stroke-width="12" stroke-linecap="round"/>
          <text x="78" y="92" font-family="Inter, system-ui" font-weight="800" font-size="40" fill="url(#lg)">C²</text>
        </svg>
        <div class="leading-tight">
          <h1 class="text-2xl font-extrabold">Calculadora do Contador</h1>
          <p class="text-[11px] text-gray-500">Simuladores tributários e trabalhistas</p>
        </div>
      </a>

      <nav class="relative hidden md:flex items-center gap-6 text-sm text-gray-600" id="topnav">
        <a href="#/" class="nav-link py-4" data-nav>Início</a>
        <a href="#/reforma" class="nav-link py-4" data-nav>Reforma</a>
        <a href="#/apuracao" class="nav-link py-4" data-nav>Apuração</a>
        <a href="#/iss" class="nav-link py-4" data-nav>ISS Simples</a>
        <a href="#/parcelamento" class="nav-link py-4" data-nav>Parcelamento</a>
        <a href="#/trabalhista" class="nav-link py-4" data-nav>Trabalhista</a>
        <!-- Novos atalhos (calculadoras adicionais) -->
        <a href="#/inss" class="nav-link py-4" data-nav>INSS</a>
        <a href="#/juros" class="nav-link py-4" data-nav>Juros</a>
        <a href="#/taxa-legal" class="nav-link py-4" data-nav>Taxa Legal</a>
        <a href="#/irrf" class="nav-link py-4" data-nav>IRRF</a>

        <a href="#/planos" class="nav-link py-4" data-nav>Planos</a>
        <a href="#/login" class="nav-link py-4" data-nav>Login</a>
        <span class="text-[11px] text-gray-400 select-none" id="badgeSims"></span>
        <span class="nav-underline" id="navBar" style="left:0;width:0"></span>
      </nav>

      <button id="openMenu" class="md:hidden p-2 rounded-lg border" aria-label="Abrir menu">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M3 5h14M3 10h14M3 15h14"/></svg>
      </button>
    </div>

    <!-- Mobile -->
    <div id="mobileNav" class="md:hidden hidden border-t bg-white">
      <div class="max-w-7xl mx-auto px-4 py-2 grid gap-1 text-sm">
        <a href="#/" class="px-2 py-2 rounded-lg hover:bg-gray-50" data-nav>Início</a>
        <a href="#/reforma" class="px-2 py-2 rounded-lg hover:bg-gray-50" data-nav>Reforma</a>
        <a href="#/apuracao" class="px-2 py-2 rounded-lg hover:bg-gray-50" data-nav>Apuração</a>
        <a href="#/iss" class="px-2 py-2 rounded-lg hover:bg-gray-50" data-nav>ISS Simples</a>
        <a href="#/parcelamento" class="px-2 py-2 rounded-lg hover:bg-gray-50" data-nav>Parcelamento</a>
        <a href="#/trabalhista" class="px-2 py-2 rounded-lg hover:bg-gray-50" data-nav>Trabalhista</a>
        <a href="#/inss" class="px-2 py-2 rounded-lg hover:bg-gray-50" data-nav>INSS</a>
        <a href="#/juros" class="px-2 py-2 rounded-lg hover:bg-gray-50" data-nav>Juros</a>
        <a href="#/taxa-legal" class="px-2 py-2 rounded-lg hover:bg-gray-50" data-nav>Taxa Legal</a>
        <a href="#/irrf" class="px-2 py-2 rounded-lg hover:bg-gray-50" data-nav>IRRF</a>
        <a href="#/planos" class="px-2 py-2 rounded-lg hover:bg-gray-50" data-nav>Planos</a>
        <a href="#/login" class="px-2 py-2 rounded-lg bg-blue-600 text-white text-center" data-nav>Login</a>
      </div>
    </div>
  </header>

  <!-- VIEWS (SPA) -->
  <main class="min-h-[70vh]" id="app">
    <!-- HOME -->
    <section data-route="/" class="route">
      <section class="pt-12 bg-gradient-to-b from-sky-50/70 to-white relative overflow-hidden">
        <div aria-hidden="true" class="pointer-events-none absolute -top-24 -right-20 w-[520px] h-[520px] rounded-full blur-3xl bg-sky-200/60 floaty"></div>
        <div aria-hidden="true" class="pointer-events-none absolute -bottom-28 -left-20 w-[520px] h-[520px] rounded-full blur-3xl bg-emerald-200/60 floaty" style="animation-delay:.6s"></div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 grid lg:grid-cols-2 gap-10 items-center">
          <div class="reveal">
            <div class="inline-flex items-center gap-2 text-[11px] font-medium px-2.5 py-1 rounded-full bg-white shadow border">
              <span class="w-1.5 h-1.5 rounded-full bg-emerald-500"></span>
              MVP pronto para publicar
            </div>
            <h2 class="mt-3 text-4xl sm:text-5xl font-extrabold leading-tight">
              Simuladores <span class="shine">tributários e trabalhistas</span>
            </h2>
            <p class="mt-3 text-gray-600 text-lg">
              Compare cenários, gere relatórios e exporte em <strong>PDF/Excel</strong> — tudo 100% no navegador, com <strong>3 simulações grátis</strong>.
            </p>
            <ul class="mt-4 text-sm text-gray-600 grid gap-2">
              <li class="flex items-center gap-2"><span class="w-1.5 h-1.5 rounded-full bg-blue-600"></span> Reforma Tributária com pré vs pós e <em>cashback</em>.</li>
              <li class="flex items-center gap-2"><span class="w-1.5 h-1.5 rounded-full bg-emerald-600"></span> Apuração mensal (LP/LR/SN) e ISS do Simples.</li>
              <li class="flex items-center gap-2"><span class="w-1.5 h-1.5 rounded-full bg-indigo-600"></span> Novas calculadoras: INSS, Juros (simples/comp.), Taxa Legal e IRRF.</li>
            </ul>
            <div class="mt-6 flex flex-wrap gap-3">
              <a href="#/reforma" data-nav class="px-5 py-3 rounded-xl bg-blue-600 text-white font-semibold shadow hover:shadow-lg hover:scale-[1.02] transition">Abrir Simulador Reforma</a>
              <a href="#/planos" data-nav class="px-5 py-3 rounded-xl border font-semibold hover:bg-gray-50">Ver Planos</a>
            </div>

            <div class="mt-6 grid sm:grid-cols-2 gap-3 text-sm">
              <div class="p-3 rounded-xl border bg-white/60">
                <div class="text-xs text-gray-500">Exportações</div>
                <div class="font-semibold">PDF e Excel</div>
              </div>
              <div class="p-3 rounded-xl border bg-white/60">
                <div class="text-xs text-gray-500">Privacidade</div>
                <div class="font-semibold">Dados locais (LGPD)</div>
              </div>
            </div>
          </div>

          <div class="reveal">
            <div class="relative mx-auto w-full max-w-xl">
              <div class="aspect-[4/3] rounded-2xl shadow-xl border bg-white overflow-hidden">
                <div class="p-4 border-b flex items-center justify-between">
                  <div class="flex items-center gap-2 text-sm text-gray-500">
                    <span class="w-2.5 h-2.5 rounded-full bg-rose-500"></span>
                    <span class="w-2.5 h-2.5 rounded-full bg-amber-500"></span>
                    <span class="w-2.5 h-2.5 rounded-full bg-emerald-500"></span>
                  </div>
                  <div class="text-sm text-gray-600">Pré vs Pós Reforma</div>
                </div>
                <div class="p-6 grid gap-4 text-sm">
                  <div class="grid grid-cols-2 gap-4">
                    <div class="rounded-xl border p-3">
                      <div class="text-xs text-gray-500">Alíquota efetiva (Pré)</div>
                      <div class="text-2xl font-bold" id="demoAliPre">18,20%</div>
                    </div>
                    <div class="rounded-xl border p-3">
                      <div class="text-xs text-gray-500">Alíquota efetiva (Pós)</div>
                      <div class="text-2xl font-bold" id="demoAliPos">16,40%</div>
                    </div>
                  </div>
                  <div><canvas id="demoChart" height="120"></canvas></div>
                  <div class="text-xs text-gray-500">Demonstração ilustrativa com dados fictícios.</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Como a Reforma te afeta (com marca d’água da logo ao fundo) -->
      <section class="py-12 wm">
        <!-- Logo de fundo -->
        <svg viewBox="0 0 128 128" aria-hidden="true">
          <defs>
            <linearGradient id="lg2" x1="0" x2="1" y1="0" y2="1">
              <stop offset="0%" stop-color="#2563eb"/><stop offset="100%" stop-color="#10b981"/>
            </linearGradient>
          </defs>
          <path d="M90 40a30 30 0 1 0 0 48" fill="none" stroke="url(#lg2)" stroke-width="12" stroke-linecap="round"/>
          <path d="M68 24c18 0 28 10 28 10" fill="none" stroke="url(#lg2)" stroke-width="12" stroke-linecap="round"/>
          <text x="78" y="92" font-family="Inter, system-ui" font-weight="800" font-size="40" fill="url(#lg2)">C²</text>
        </svg>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <h3 class="text-2xl font-bold">Como a Reforma te afeta</h3>
          <p class="text-sm text-gray-600 mt-1">Entenda, em minutos, os impactos práticos no seu negócio.</p>

          <div class="mt-6 grid md:grid-cols-3 gap-5">
            <div class="card reveal hover:shadow-lg transition">
              <div class="text-sm text-gray-500 mb-1">IBS + CBS (IVA-Dual)</div>
              <p class="text-sm">Modelo por destino com <strong>crédito amplo</strong>. Compra gera crédito, venda gera débito — menos cumulatividade e mais previsibilidade.</p>
            </div>
            <div class="card reveal hover:shadow-lg transition">
              <div class="text-sm text-gray-500 mb-1">Transição planejada</div>
              <p class="text-sm"><strong>2026</strong> (ano-teste), <strong>2027–2032</strong> (substituição progressiva) e <strong>2033</strong> (vigência plena). Dá para <strong>ajustar preços e margens</strong> com antecedência.</p>
            </div>
            <div class="card reveal hover:shadow-lg transition">
              <div class="text-sm text-gray-500 mb-1">Setores & IS</div>
              <p class="text-sm">Saúde/educação/transporte podem ter <strong>alíquota reduzida</strong>. Bens/serviços nocivos pagam <strong>Imposto Seletivo</strong>.</p>
            </div>
          </div>

          <div class="mt-6 grid md:grid-cols-3 gap-5">
            <div class="card reveal hover:shadow-lg transition">
              <div class="text-sm text-gray-500 mb-1">Fluxo de caixa</div>
              <p class="text-sm"><strong>Crédito financeiro</strong> melhora o capital de giro de quem investe e compra insumos tributados.</p>
            </div>
            <div class="card reveal hover:shadow-lg transition">
              <div class="text-sm text-gray-500 mb-1">Simples Nacional</div>
              <p class="text-sm">Mantido (LC 123). <strong>Anexos/PD</strong> permanecem. Compare <strong>Simples × não cumulativo</strong> no simulador.</p>
            </div>
            <div class="card reveal hover:shadow-lg transition">
              <div class="text-sm text-gray-500 mb-1">Consumidor final</div>
              <p class="text-sm">Possibilidade de <strong>cashback</strong> no consumo essencial — impacto direto em demanda e precificação.</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Simulações (com marca d’água) -->
      <section class="pb-12 wm">
        <!-- Logo de fundo -->
        <svg viewBox="0 0 128 128" aria-hidden="true">
          <defs>
            <linearGradient id="lg3" x1="0" x2="1" y1="0" y2="1">
              <stop offset="0%" stop-color="#2563eb"/><stop offset="100%" stop-color="#10b981"/>
            </linearGradient>
          </defs>
          <path d="M90 40a30 30 0 1 0 0 48" fill="none" stroke="url(#lg3)" stroke-width="12" stroke-linecap="round"/>
          <path d="M68 24c18 0 28 10 28 10" fill="none" stroke="url(#lg3)" stroke-width="12" stroke-linecap="round"/>
          <text x="78" y="92" font-family="Inter, system-ui" font-weight="800" font-size="40" fill="url(#lg3)">C²</text>
        </svg>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <h3 class="text-2xl font-bold">Simulações de empresas</h3>
          <p class="text-sm text-gray-600 mt-1">Compare rapidamente e abra no simulador para editar.</p>

          <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Card 1 -->
            <div class="card reveal hover:shadow-lg hover:scale-[1.01] transition" id="ex1">
              <div class="flex items-start justify-between">
                <div>
                  <div class="text-sm font-semibold">Comércio — SP</div>
                  <div class="text-xs text-gray-500">Lucro Presumido • R$ 120.000/mês</div>
                </div>
              </div>
              <div class="mt-3 grid grid-cols-2 gap-3 text-sm">
                <div class="kpi"><span class="label">Pré</span><span class="value" id="ex1Pre">–</span></div>
                <div class="kpi"><span class="label">Pós</span><span class="value" id="ex1Pos">–</span></div>
              </div>
              <div class="mt-3"><canvas id="ex1Chart" height="80"></canvas></div>
              <p class="text-xs text-gray-500 mt-2" id="ex1Delta">–</p>
              <button class="mt-3 px-3 py-2 rounded-xl bg-blue-600 text-white text-sm" data-open-example="1">Ver no simulador</button>
            </div>

            <!-- Card 2 -->
            <div class="card reveal hover:shadow-lg hover:scale-[1.01] transition" id="ex2">
              <div class="flex items-start justify-between">
                <div>
                  <div class="text-sm font-semibold">Transporte — RJ</div>
                  <div class="text-xs text-gray-500">Lucro Real • R$ 80.000/mês</div>
                </div>
              </div>
              <div class="mt-3 grid grid-cols-2 gap-3 text-sm">
                <div class="kpi"><span class="label">Pré</span><span class="value" id="ex2Pre">–</span></div>
                <div class="kpi"><span class="label">Pós</span><span class="value" id="ex2Pos">–</span></div>
              </div>
              <div class="mt-3"><canvas id="ex2Chart" height="80"></canvas></div>
              <p class="text-xs text-gray-500 mt-2" id="ex2Delta">–</p>
              <button class="mt-3 px-3 py-2 rounded-xl bg-blue-600 text-white text-sm" data-open-example="2">Ver no simulador</button>
            </div>

            <!-- Card 3 -->
            <div class="card reveal hover:shadow-lg hover:scale-[1.01] transition" id="ex3">
              <div class="flex items-start justify-between">
                <div>
                  <div class="text-sm font-semibold">Indústria — MG</div>
                  <div class="text-xs text-gray-500">Lucro Real • R$ 300.000/mês</div>
                </div>
              </div>
              <div class="mt-3 grid grid-cols-2 gap-3 text-sm">
                <div class="kpi"><span class="label">Pré</span><span class="value" id="ex3Pre">–</span></div>
                <div class="kpi"><span class="label">Pós</span><span class="value" id="ex3Pos">–</span></div>
              </div>
              <div class="mt-3"><canvas id="ex3Chart" height="80"></canvas></div>
              <p class="text-xs text-gray-500 mt-2" id="ex3Delta">–</p>
              <button class="mt-3 px-3 py-2 rounded-xl bg-blue-600 text-white text-sm" data-open-example="3">Ver no simulador</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Módulos -->
      <section class="py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <h3 class="text-2xl font-bold">Módulos</h3>
          <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-5">
            <a href="#/reforma" data-nav class="card hover:shadow-md transition-all">
              <div class="font-semibold">Reforma Tributária</div>
              <p class="text-sm text-gray-600 mt-2">Comparativo CBS/IBS/IS vs sistema atual.</p>
            </a>
            <a href="#/apuracao" data-nav class="card hover:shadow-md transition-all">
              <div class="font-semibold">Apuração mensal</div>
              <p class="text-sm text-gray-600 mt-2">Cálculo de tributos do mês.</p>
            </a>
            <a href="#/iss" data-nav class="card hover:shadow-md transition-all">
              <div class="font-semibold">ISS — Simples</div>
              <p class="text-sm text-gray-600 mt-2">Alíquota efetiva com PD e Fator R.</p>
            </a>
            <a href="#/parcelamento" data-nav class="card hover:shadow-md transition-all">
              <div class="font-semibold">Parcelamento do Simples</div>
              <p class="text-sm text-gray-600 mt-2">Price/linear + memória.</p>
            </a>
            <a href="#/trabalhista" data-nav class="card hover:shadow-md transition-all">
              <div class="font-semibold">Cálculos Trabalhistas</div>
              <p class="text-sm text-gray-600 mt-2">Férias, 13º, FGTS e rescisão (básico).</p>
            </a>
          </div>

          <!-- Atalhos para novas calculadoras -->
          <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5">
            <a href="#/inss" data-nav class="card hover:shadow-md transition-all">
              <div class="font-semibold">INSS a descontar</div>
              <p class="text-sm text-gray-600 mt-2">Desconto do segurado com tabela progressiva.</p>
            </a>
            <a href="#/juros" data-nav class="card hover:shadow-md transition-all">
              <div class="font-semibold">Juros simples e compostos</div>
              <p class="text-sm text-gray-600 mt-2">Compare montante, taxa e prazo.</p>
            </a>
            <a href="#/taxa-legal" data-nav class="card hover:shadow-md transition-all">
              <div class="font-semibold">Taxa Legal (Lei 14.905/2024)</div>
              <p class="text-sm text-gray-600 mt-2">Juros Selic – IPCA, regime simples.</p>
            </a>
            <a href="#/irrf" data-nav class="card hover:shadow-md transition-all">
              <div class="font-semibold">IRRF Online</div>
              <p class="text-sm text-gray-600 mt-2">Tabelas atualizadas até a MP 1.294/2025.</p>
            </a>
          </div>
        </div>
      </section>
    </section>

    <!-- LOGIN -->
    <section data-route="/login" class="route hidden">
      <div class="max-w-md mx-auto px-4 sm:px-6 lg:px-8 py-10">
        <h2 class="text-2xl font-bold">Entrar / Cadastrar</h2>
        <p class="text-sm text-gray-600 mt-1">3 simulações gratuitas após cadastro. Planos pagos liberam uso ilimitado.</p>
        <form id="authForm" class="mt-6 grid gap-4">
          <div>
            <label class="block text-sm font-medium">E-mail</label>
            <input id="authEmail" type="email" required class="mt-1 w-full rounded-xl border p-2" placeholder="exemplo@dominio.com"/>
          </div>
          <div>
            <label class="block text-sm font-medium">Telefone (WhatsApp)</label>
            <input id="authPhone" type="tel" required class="mt-1 w-full rounded-xl border p-2" placeholder="(11) 99999-9999"/>
          </div>
          <button class="px-4 py-2 rounded-xl bg-blue-600 text-white">Continuar</button>
        </form>
        <p class="text-xs text-gray-500 mt-3">Ao continuar, você concorda com os termos de uso. Dados armazenados localmente (LGPD).</p>
      </div>
    </section>

    <!-- PLANOS -->
    <section data-route="/planos" class="route hidden">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
        <h2 class="text-2xl font-bold">Planos</h2>
        <p class="text-sm text-gray-600 mt-1">Comece grátis. Precisa de mais? Escolha um plano.</p>
        <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="card">
            <div class="text-sm font-semibold">Pro 5</div>
            <div class="text-3xl font-extrabold mt-1">R$ 49,99<span class="text-base font-medium text-gray-500">/mês</span></div>
            <p class="text-sm text-gray-600 mt-2">Até 5 usuários, simulações ilimitadas.</p>
            <button class="mt-4 px-4 py-2 rounded-xl bg-blue-600 text-white" data-plan="PRO5">Assinar</button>
          </div>
          <div class="card border-2 border-blue-600">
            <div class="text-sm font-semibold">Pro 50</div>
            <div class="text-3xl font-extrabold mt-1">R$ 69,99<span class="text-base font-medium text-gray-500">/mês</span></div>
            <p class="text-sm text-gray-600 mt-2">Até 50 usuários, simulações ilimitadas.</p>
            <button class="mt-4 px-4 py-2 rounded-xl bg-blue-600 text-white" data-plan="PRO50">Assinar</button>
          </div>
          <div class="card">
            <div class="text-sm font-semibold">Ilimitado</div>
            <div class="text-3xl font-extrabold mt-1">R$ 89,99<span class="text-base font-medium text-gray-500">/mês</span></div>
            <p class="text-sm text-gray-600 mt-2">Usuários ilimitados, simulações ilimitadas.</p>
            <button class="mt-4 px-4 py-2 rounded-xl bg-blue-600 text-white" data-plan="PROUNL">Assinar</button>
          </div>
        </div>
        <p class="text-xs text-gray-500 mt-4">Pagamento simulado no MVP (localStorage). Integração real pode ser adicionada depois.</p>
      </div>
    </section>

    <!-- REFORMA (estrutura visual; scripts na 2ª metade) -->
    <section data-route="/reforma" class="route hidden">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- ESQUERDA -->
        <section class="lg:col-span-2 space-y-6">
          <div class="card">
            <h2 class="text-xl font-semibold mb-4">Perfil e Dados Econômicos</h2>
            <form id="formReforma" class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium">Tipo de empresa</label>
                <select id="tipoEmpresa" class="mt-1 w-full rounded-xl border p-2">
                  <option selected>Lucro Presumido</option>
                  <option>Lucro Real</option>
                  <option>Simples Nacional</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium">Setor</label>
                <select id="setor" class="mt-1 w-full rounded-xl border p-2">
                  <option value="industria">Indústria</option>
                  <option value="comercio" selected>Comércio</option>
                  <option value="servico">Serviços</option>
                  <option value="agro">Agropecuária</option>
                  <option value="tecnologia">Tecnologia</option>
                  <option value="transporte">Transporte</option>
                  <option value="financeiro">Financeiro</option>
                  <option value="saude">Saúde</option>
                  <option value="educacao">Educação</option>
                  <option value="outros">Outros</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium">UF</label>
                <input id="uf" class="mt-1 w-full rounded-xl border p-2" value="SP"/>
              </div>
              <div>
                <label class="block text-sm font-medium">Município</label>
                <input id="municipio" class="mt-1 w-full rounded-xl border p-2" value="São Paulo"/>
              </div>

              <div>
                <label class="block text-sm font-medium">Faturamento mensal (R$)</label>
                <input id="faturamentoMensal" type="number" class="mt-1 w-full rounded-xl border p-2" value="120000.00" step="0.01"/>
              </div>
              <div>
                <label class="block text-sm font-medium">Faturamento anual (R$)</label>
                <input id="faturamentoAnual" type="number" class="mt-1 w-full rounded-xl border p-2" value="1440000.00" step="0.01"/>
              </div>

              <div>
                <label class="block text-sm font-medium">Custos/insumos (R$)</label>
                <input id="custos" type="number" class="mt-1 w-full rounded-xl border p-2" value="60000.00" step="0.01"/>
              </div>
              <div>
                <label class="block text-sm font-medium">Folha (R$)</label>
                <input id="folha" type="number" class="mt-1 w-full rounded-xl border p-2" value="30000.00" step="0.01"/>
              </div>
              <div>
                <label class="block text-sm font-medium">Despesas operacionais (R$)</label>
                <input id="despesas" type="number" class="mt-1 w-full rounded-xl border p-2" value="15000.00" step="0.01"/>
              </div>
              <div>
                <label class="block text-sm font-medium">Exportações (R$)</label>
                <input id="exportacoes" type="number" class="mt-1 w-full rounded-xl border p-2" value="0.00" step="0.01"/>
              </div>
              <div>
                <label class="block text-sm font-medium">Investimentos (bens de capital) (R$)</label>
                <input id="investimentos" type="number" class="mt-1 w-full rounded-xl border p-2" value="0.00" step="0.01"/>
              </div>
              <div>
                <label class="block text-sm font-medium">Serviços tomados (R$)</label>
                <input id="servicosTomados" type="number" class="mt-1 w-full rounded-xl border p-2" value="10000.00" step="0.01"/>
              </div>
              <div>
                <label class="block text-sm font-medium">Créditos fiscais pré-reforma (R$)</label>
                <input id="creditosPre" type="number" class="mt-1 w-full rounded-xl border p-2" value="0.00" step="0.01"/>
              </div>
              <div>
                <label class="block text-sm font-medium">Créditos fiscais pós-reforma (R$)</label>
                <input id="creditosPos" type="number" class="mt-1 w-full rounded-xl border p-2" value="0.00" step="0.01"/>
              </div>

              <div class="md:col-span-2 grid grid-cols-1 md:grid-cols-3 gap-4 bg-gray-50 p-3 rounded-xl">
                <div>
                  <label class="block text-sm font-medium">Ano de referência</label>
                  <select id="ano" class="mt-1 w-full rounded-xl border p-2">
                    <option>2026</option><option>2027</option><option>2028</option><option>2029</option>
                    <option>2030</option><option>2031</option><option>2032</option><option>2033</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium">Ano-teste 2026 (CBS 0,9% • IBS 0,1%)</label>
                  <select id="usarAnoTeste" class="mt-1 w-full rounded-xl border p-2">
                    <option>Sim</option><option>Não</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium">Alíquota padrão IBS+CBS (≥2027)</label>
                  <input id="aliquotaPadrao" type="number" step="0.001" class="mt-1 w-full rounded-xl border p-2" value="0.265"/>
                  <p class="text-xs text-gray-500 mt-1">0,265 = 26,5% (parametrizável)</p>
                </div>
              </div>

              <div id="simplesBlock" class="hidden md:col-span-2 grid grid-cols-1 md:grid-cols-3 gap-4 bg-blue-50 p-3 rounded-xl">
                <div>
                  <label class="block text-sm font-medium">Anexo do Simples</label>
                  <select id="simplesAnexo" class="mt-1 w-full rounded-xl border p-2">
                    <option>I</option><option>II</option><option>III</option><option>IV</option><option>V</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium">RBT12 (R$)</label>
                  <input id="rbt12" type="number" class="mt-1 w-full rounded-xl border p-2" value="1440000.00" step="0.01"/>
                </div>
                <div>
                  <label class="block text-sm font-medium">Fator R (0–1)</label>
                  <input id="fatorR" type="number" step="0.01" class="mt-1 w-full rounded-xl border p-2" value="0.25"/>
                  <p class="text-xs text-gray-500 mt-1">Se ≥ 0,28 → Anexo III; senão, V (para atividades dos Anexos III/V).</p>
                </div>
              </div>

              <div class="md:col-span-2 grid grid-cols-1 md:grid-cols-3 gap-4 bg-green-50 p-3 rounded-xl">
                <div>
                  <label class="block text-sm font-medium">Setor com alíquota diferenciada?</label>
                  <select id="aplicarReducao" class="mt-1 w-full rounded-xl border p-2">
                    <option>Não</option><option>Sim</option>
                  </select>
                  <p class="text-xs muted mt-1">Ex.: saúde/educação/transporte (parâmetro)</p>
                </div>
                <div>
                  <label class="block text-sm font-medium">Imposto Seletivo (IS) aplicável?</label>
                  <select id="isAplicavel" class="mt-1 w-full rounded-xl border p-2">
                    <option>Não</option><option>Sim</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium">Alíquota do IS (0–1)</label>
                  <input id="isAliquota" type="number" step="0.01" class="mt-1 w-full rounded-xl border p-2" value="0"/>
                </div>
              </div>

              <div class="md:col-span-2 grid grid-cols-1 md:grid-cols-3 gap-4 bg-emerald-50 p-3 rounded-xl">
                <div>
                  <label class="block text-sm font-medium">Cashback PF (%)</label>
                  <input id="cashPF" type="number" step="0.01" class="mt-1 w-full rounded-xl border p-2" value="0"/>
                </div>
                <div>
                  <label class="block text-sm font-medium">Cashback MEI (%)</label>
                  <input id="cashMEI" type="number" step="0.01" class="mt-1 w-full rounded-xl border p-2" value="0"/>
                </div>
                <div>
                  <label class="block text-sm font-medium">Base de consumo essencial (R$)</label>
                  <input id="baseCash" type="number" class="mt-1 w-full rounded-xl border p-2" value="0.00" step="0.01"/>
                </div>
              </div>

              <div class="md:col-span-2 flex flex-wrap gap-3 pt-2">
                <button type="button" id="btnCalcular" class="px-4 py-2 rounded-xl bg-blue-600 text-white">Calcular</button>
                <button type="button" id="btnReset" class="px-4 py-2 rounded-xl bg-gray-900 text-white">Limpar</button>
                <button type="button" id="btnPDF" class="px-4 py-2 rounded-xl bg-rose-600 text-white">Exportar PDF</button>
                <button type="button" id="btnXLSX" class="px-4 py-2 rounded-xl bg-teal-600 text-white">Exportar Excel</button>
              </div>
            </form>
          </div>

          <div class="card" id="legal">
            <h3 class="text-lg font-semibold">Informativo Legal</h3>
            <div class="prose max-w-none">
              <p><strong>O que é:</strong> A EC 132/2023 institui IBS/CBS e IS. A LC 214/2025 disciplina regras gerais, transição e regimes diferenciados. O PLP 68/2024 deu origem à LC 214.</p>
              <ul>
                <li><strong>Transição:</strong> 2026 (CBS 0,9% + IBS 0,1% — ano-teste); 2027–2032 substituição progressiva; 2033 substituição completa.</li>
                <li><strong>Simples Nacional:</strong> mantém-se (LC 123/2006). Fórmula oficial: <em>(RBT12 × alíquota − PD) ÷ RBT12</em>.</li>
              </ul>
              <p class="text-sm text-gray-600">LGPD: por padrão os dados ficam no seu navegador (localStorage). Aviso: resultados são estimativas e não constituem aconselhamento fiscal definitivo.</p>
            </div>
          </div>
        </section>

        <!-- DIREITA -->
        <aside class="space-y-6">
          <div class="card">
            <h3 class="text-lg font-semibold">Resultados</h3>
            <div class="text-sm grid grid-cols-1 gap-4 mt-2">
              <div class="rounded-xl border p-4">
                <div class="font-medium mb-2">Pré-Reforma</div>
                <ul class="space-y-1" id="preList"></ul>
                <div class="pt-1 border-t mt-2 text-sm">Total: <strong id="preTotal">R$ 0,00</strong> <span class="text-gray-500" id="prePerc"></span></div>
              </div>
              <div class="rounded-xl border p-4">
                <div class="font-medium mb-2">Pós-Reforma</div>
                <ul class="space-y-1" id="posList"></ul>
                <div class="pt-1 border-t mt-2 text-sm">Total: <strong id="posTotal">R$ 0,00</strong> <span class="text-gray-500" id="posPerc"></span></div>
              </div>
              <div class="rounded-xl border p-4 bg-gray-50">
                <div class="font-medium mb-2">Comparativo</div>
                <p>Diferença absoluta: <strong id="diffAbs">R$ 0,00</strong><br/>Variação relativa: <strong id="diffRel">0,00%</strong></p>
              </div>
            </div>
          </div>

          <div class="card" id="graficos">
            <h3 class="text-lg font-semibold">Gráficos</h3>
            <div class="h-56"><canvas id="barChart"></canvas></div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
              <div class="h-56"><canvas id="piePre"></canvas></div>
              <div class="h-56"><canvas id="piePos"></canvas></div>
            </div>
          </div>

          <div class="card" id="relatorio">
            <h3 class="text-lg font-semibold">Relatório detalhado</h3>
            <div id="relatorioHtml" class="mt-3 text-sm"></div>
          </div>
        </aside>
      </div>
    </section>

    <!-- (A continuação com Apuração, ISS, Parcelamento, Trabalhista, INSS, Juros, Taxa Legal e IRRF + <script> completo vem na 2ª metade) -->
  </main>

  <footer class="border-t mt-10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 text-sm text-gray-500 flex flex-wrap items-center justify-between gap-3">
      <p>LGPD: dados de simulação armazenados localmente. Você pode apagar a qualquer momento.</p>
      <p>© <span id="y"></span> Calculadora do Contador — Resultados são estimativas e não constituem aconselhamento fiscal.</p>
    </div>
  </footer>

<script>
/* ===== Utilidades ===== */
const $ = (s, r=document) => r.querySelector(s);
const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));
const money = new Intl.NumberFormat('pt-BR', {style:'currency', currency:'BRL'});
const pct = new Intl.NumberFormat('pt-BR', {style:'percent', minimumFractionDigits:2, maximumFractionDigits:2});
const num = v => Number(isFinite(+v) ? +v : 0);

/* ===== Estado simples (MVP) ===== */
const db = {
  plan: localStorage.getItem('plan') || null,
  simsLeft: +(localStorage.getItem('simsLeft') ?? 3),
  user: JSON.parse(localStorage.getItem('user') || 'null')
};
function saveState(){
  localStorage.setItem('plan', db.plan ?? '');
  localStorage.setItem('simsLeft', String(db.simsLeft));
  if(db.user) localStorage.setItem('user', JSON.stringify(db.user));
}
function canSim(){
  return db.plan || db.simsLeft > 0;
}
function consumeSim(){
  if(db.plan) return true;
  if(db.simsLeft <= 0) { alert('Você usou as 3 simulações gratuitas. Assine um plano para continuar.'); return false; }
  db.simsLeft--; saveState(); updateBadge(); return true;
}
function updateBadge(){
  const el = $('#badgeSims');
  if(!el) return;
  el.textContent = db.plan ? `Plano: ${db.plan}` : `Grátis: ${db.simsLeft} sim.`;
}
updateBadge();
$('#y').textContent = new Date().getFullYear();

/* ===== Navegação SPA ===== */
const routes = $$('.route');
function showRoute(hash){
  const path = (hash || location.hash || '#/').replace('#','');
  routes.forEach(sec=>{
    const r = sec.getAttribute('data-route');
    sec.classList.toggle('hidden', r !== path);
  });
  highlightNav(path);
  window.scrollTo({top:0, behavior:'smooth'});
}
function highlightNav(path){
  const links = $$('#topnav [data-nav]');
  const bar = $('#navBar');
  let active = null;
  links.forEach(a=>{
    const match = a.getAttribute('href').replace('#','') === path;
    a.classList.toggle('text-blue-600', match);
    if(match) active = a;
  });
  if(active){
    const rect = active.getBoundingClientRect();
    const cont = active.offsetParent.getBoundingClientRect();
    bar.style.left = (rect.left - cont.left) + 'px';
    bar.style.width = rect.width + 'px';
  } else {
    bar.style.width = '0';
  }
}
window.addEventListener('hashchange', ()=>showRoute(location.hash));
$$('[data-nav]').forEach(a=>a.addEventListener('click', e=>{
  const href = a.getAttribute('href'); 
  if(href.startsWith('#/')) {
    e.preventDefault();
    location.hash = href;
    $('#mobileNav')?.classList.add('hidden');
  }
}));
showRoute(location.hash || '#/');

$('#openMenu')?.addEventListener('click', ()=> $('#mobileNav').classList.toggle('hidden'));

/* ===== Reveal on scroll ===== */
const io = new IntersectionObserver((ents)=>{
  ents.forEach(ent=>{
    if(ent.isIntersecting) ent.target.classList.add('show');
  });
},{threshold:.15});
$$('.reveal').forEach(el=>io.observe(el));

/* ===== Auth/Planos (MVP local) ===== */
$('#authForm')?.addEventListener('submit', e=>{
  e.preventDefault();
  db.user = { email: $('#authEmail').value, phone: $('#authPhone').value };
  db.simsLeft = Math.max(db.simsLeft, 3);
  saveState(); updateBadge();
  alert('Cadastro realizado! Você tem 3 simulações gratuitas.');
});
$$('[data-plan]').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    db.plan = btn.dataset.plan; saveState(); updateBadge();
    alert(`Plano ${db.plan} ativado (MVP).`);
  });
});

/* ===== CHARTS: Hero + Exemplos ===== */
let demoChart, ex1Chart, ex2Chart, ex3Chart, barChart, piePre, piePos;
function mkChart(ctx, type, data, options){ 
  if(!ctx) return null;
  if(ctx._chart) { ctx._chart.destroy(); }
  const c = new Chart(ctx, {type, data, options}); 
  ctx._chart = c; 
  return c;
}
(function hero(){
  const ctx = $('#demoChart');
  if(!ctx) return;
  demoChart = mkChart(ctx, 'line', {
    labels: ['Pré','Pós'],
    datasets: [{label:'Alíquota efetiva', data:[18.2,16.4]}]
  },{
    responsive:true, plugins:{legend:{display:false}}
  });
  $('#demoAliPre').textContent = '18,20%';
  $('#demoAliPos').textContent = '16,40%';
})();
(function exemplos(){
  const sets = [
    {pre: 13.8, pos: 12.4, el:'#ex1Chart', preId:'#ex1Pre', posId:'#ex1Pos', d:'#ex1Delta'},
    {pre: 9.2, pos: 10.1, el:'#ex2Chart', preId:'#ex2Pre', posId:'#ex2Pos', d:'#ex2Delta'},
    {pre: 21.0, pos: 18.1, el:'#ex3Chart', preId:'#ex3Pre', posId:'#ex3Pos', d:'#ex3Delta'}
  ];
  sets.forEach(s=>{
    const ctx = $(s.el);
    mkChart(ctx, 'bar', {
      labels:['Pré','Pós'],
      datasets:[{label:'Alíquota efetiva', data:[s.pre, s.pos]}]
    },{plugins:{legend:{display:false}}});
    $(s.preId).textContent = s.pre.toFixed(2).replace('.',',')+'%';
    $(s.posId).textContent = s.pos.toFixed(2).replace('.',',')+'%';
    const dif = s.pos - s.pre;
    $(s.d).textContent = 'Variação: ' + (dif>=0?'+':'') + dif.toFixed(2).replace('.',',') + '% p.p.';
  });

  $$('[data-open-example]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const id = btn.dataset.openExample;
      // Carrega valores de demonstração no formulário da Reforma
      $('#tipoEmpresa').value = (id==='1'?'Lucro Presumido':'Lucro Real');
      $('#setor').value = (id==='2'?'transporte': (id==='3'?'industria':'comercio'));
      $('#faturamentoMensal').value = (id==='3'?300000: (id==='2'?80000:120000));
      $('#custos').value = (id==='3'?180000:40000);
      $('#folha').value = (id==='3'?90000:30000);
      $('#despesas').value = 15000;
      $('#servicosTomados').value = 10000;
      $('#aliquotaPadrao').value = 0.265;
      location.hash = '#/reforma';
    });
  });
})();

/* ===== Reforma Tributária — Cálculo resumido (MVP) ===== */
function efetiva(x, fat){ return fat>0? (x/fat) : 0; }
function br(v){ return money.format(v||0); }
function perc(v){ return (100*(v||0)).toFixed(2).replace('.',',')+'%'; }

$('#btnReset')?.addEventListener('click', ()=>{
  $('#formReforma').reset();
  ['preList','posList','preTotal','posTotal','prePerc','posPerc','diffAbs','diffRel','relatorioHtml'].forEach(id=>$('#'+id).textContent='');
  if(barChart) barChart.destroy();
  if(piePre) piePre.destroy();
  if(piePos) piePos.destroy();
});
$('#btnCalcular')?.addEventListener('click', ()=>{
  if(!canSim()) return;
  if(!consumeSim()) return;
  calcReforma();
});
$('#btnPDF')?.addEventListener('click', ()=> exportReformaPDF());
$('#btnXLSX')?.addEventListener('click', ()=> exportReformaXLSX());
$('#tipoEmpresa')?.addEventListener('change', e=>{
  $('#simplesBlock').classList.toggle('hidden', e.target.value!=='Simples Nacional');
});

function calcReforma(){
  const tipo = $('#tipoEmpresa').value;
  const setor = $('#setor').value;
  const fat = num($('#faturamentoMensal').value);
  const custos = num($('#custos').value);
  const folha = num($('#folha').value);
  const despesas = num($('#despesas').value);
  const servTom = num($('#servicosTomados').value);
  const inv = num($('#investimentos').value);
  const credPre = num($('#creditosPre').value);
  const credPos = num($('#creditosPos').value);

  const usarAnoTeste = ($('#usarAnoTeste').value === 'Sim');
  let aliqPadrao = num($('#aliquotaPadrao').value || 0.265); // 26,5%
  const reducao = ($('#aplicarReducao').value === 'Sim');
  const isApl = ($('#isAplicavel').value === 'Sim');
  const isAliq = num($('#isAliquota').value);
  const cashPF = num($('#cashPF').value)/100;
  const cashMEI = num($('#cashMEI').value)/100;
  const baseCash = num($('#baseCash').value);

  // Pré (simplificado por setor/regime)
  let pre = {};
  // PIS/COFINS
  if(tipo==='Lucro Real'){ pre.piscofins = fat*0.0925 - Math.min(fat*0.0925, (custos+servTom+despesas)*0.0925) - credPre; }
  else if(tipo==='Lucro Presumido'){ pre.piscofins = fat*0.0365 - credPre; }
  else { pre.piscofins = fat*0.02 - credPre; } // aproximação SN (parte dentro do DAS)
  // ICMS/ISS/IPI (aproximações por setor)
  if(setor==='servico'){
    pre.iss = fat*0.05;
    pre.icms = 0; pre.ipi = 0;
  } else if(setor==='industria'){
    pre.icms = fat*0.18; pre.ipi = fat*0.03; pre.iss = 0;
  } else if(setor==='comercio'){
    pre.icms = fat*0.12; pre.ipi = 0; pre.iss = 0;
  } else {
    pre.icms = fat*0.12; pre.ipi = 0.01*fat; pre.iss= (setor==='transporte'? fat*0.03:0);
  }
  Object.keys(pre).forEach(k=> pre[k] = Math.max(0, pre[k]));
  const preTotal = Math.max(0, (pre.piscofins||0)+(pre.icms||0)+(pre.ipi||0)+(pre.iss||0));

  // Pós (IBS/CBS por débito vs crédito)
  let alq = usarAnoTeste ? (0.009+0.001) : aliqPadrao;
  if(reducao) alq *= 0.6; // redução param (ex.: 40%)
  const debito = fat * alq;
  const creditoBase = (custos + servTom + inv) * alq;
  let pos = {};
  pos.ibscbs = Math.max(0, debito - creditoBase - credPos);
  pos.is = isApl ? fat * isAliq : 0;

  // Cashback (benefício ao consumidor; aqui mostramos como redutor ilustrativo)
  const cashVal = Math.max(0, Math.min(baseCash, fat) * (cashPF + cashMEI));
  let posTotal = Math.max(0, pos.ibscbs + pos.is - cashVal);

  // UI lists
  $('#preList').innerHTML = `
    <li>PIS/COFINS: <strong>${br(pre.piscofins)}</strong></li>
    <li>ICMS: <strong>${br(pre.icms)}</strong></li>
    <li>IPI: <strong>${br(pre.ipi)}</strong></li>
    <li>ISS: <strong>${br(pre.iss)}</strong></li>
  `;
  $('#posList').innerHTML = `
    <li>IBS + CBS (líquido): <strong>${br(pos.ibscbs)}</strong></li>
    <li>Imposto Seletivo: <strong>${br(pos.is)}</strong></li>
    <li>Cashback ilustrativo: <strong>− ${br(cashVal)}</strong></li>
  `;
  $('#preTotal').textContent = br(preTotal);
  $('#posTotal').textContent = br(posTotal);
  $('#prePerc').textContent = `(${perc(efetiva(preTotal, fat))})`;
  $('#posPerc').textContent = `(${perc(efetiva(posTotal, fat))})`;
  const diff = posTotal - preTotal;
  $('#diffAbs').textContent = br(diff);
  $('#diffRel').textContent = (fat>0? (diff/fat*100):0).toFixed(2).replace('.',',')+'%';

  // Relatório
  $('#relatorioHtml').innerHTML = `
    <div><strong>Empresa:</strong> ${tipo} • Setor: ${$('#setor').options[$('#setor').selectedIndex].text}</div>
    <div><strong>Faturamento:</strong> ${br(fat)} • Custos: ${br(custos)} • Folha: ${br(folha)}</div>
    <div><strong>Alíquota padrão (pos):</strong> ${perc(aliqPadrao)} • Redução setorial: ${reducao?'Sim':'Não'} • IS: ${isApl?perc(isAliq):'Não'}</div>
  `;

  // Gráficos
  barChart = mkChart($('#barChart'), 'bar', {
    labels:['Pré','Pós'],
    datasets:[{label:'Total', data:[preTotal, posTotal]}]
  },{plugins:{legend:{display:false}}});

  piePre = mkChart($('#piePre'), 'pie', {
    labels:['PIS/COFINS','ICMS','IPI','ISS'],
    datasets:[{data:[pre.piscofins, pre.icms, pre.ipi, pre.iss]}]
  },{});
  piePos = mkChart($('#piePos'), 'pie', {
    labels:['IBS+CBS líquido','Imposto Seletivo','Cashback (−)'],
    datasets:[{data:[pos.ibscbs, pos.is, cashVal]}]
  },{});
}

/* ===== Export (Reforma) ===== */
function exportReformaPDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFontSize(14);
  doc.text('Relatório — Simulador Reforma', 14, 16);
  doc.setFontSize(10);
  const rows = [
    ['Pré-Reforma', $('#preTotal').textContent, $('#prePerc').textContent],
    ['Pós-Reforma', $('#posTotal').textContent, $('#posPerc').textContent],
    ['Diferença', $('#diffAbs').textContent, $('#diffRel').textContent]
  ];
  let y=26;
  rows.forEach(r=>{ doc.text(`${r[0]}  |  Total: ${r[1]}  |  Efetiva: ${r[2]}`, 14, y); y+=8; });
  doc.text('Detalhes:', 14, y); y+=6;
  doc.text($('#relatorioHtml').innerText.slice(0, 400), 14, y, {maxWidth: 180});
  doc.save('relatorio-reforma.pdf');
}
function exportReformaXLSX(){
  const wb = XLSX.utils.book_new();
  const data = [
    ['Item','Valor'],
    ['Pré-Reforma', $('#preTotal').textContent],
    ['Pós-Reforma', $('#posTotal').textContent],
    ['Diferença', $('#diffAbs').textContent],
    ['Efetiva Pré', $('#prePerc').textContent],
    ['Efetiva Pós', $('#posPerc').textContent]
  ];
  const ws = XLSX.utils.aoa_to_sheet(data);
  XLSX.utils.book_append_sheet(wb, ws, 'Resumo');
  XLSX.writeFile(wb, 'reforma-resumo.xlsx');
}

/* ===== APURAÇÃO ===== */
$('#btnApurar')?.addEventListener('click', ()=>{
  if(!canSim()) return; if(!consumeSim()) return;
  const reg = $('#apRegime').value;
  const R = num($('#apReceita').value);
  const D = num($('#apCreditos').value);
  const icms = num($('#apICMS').value)/100;
  const iss = num($('#apISS').value)/100;
  const pis = num($('#apPIS').value)/100;
  const cof = num($('#apCOF').value)/100;
  let t = {};
  if(reg==='LR'){
    t.pis = Math.max(0, R*0.0165 - D*0.0165);
    t.cof = Math.max(0, R*0.076 - D*0.076);
  }else if(reg==='LP'){
    t.pis = R*0.0065; t.cof = R*0.03;
  }else{
    t.das = R*0.06; // aproximação
  }
  t.icms = R*icms; t.iss = R*iss;
  const total = Object.values(t).reduce((a,b)=>a+(b||0),0);
  $('#apLista').innerHTML = Object.entries(t).map(([k,v])=>`<li>${k.toUpperCase()}: <strong>${br(v)}</strong></li>`).join('');
  $('#apTotal').textContent = br(total);
});
$('#btnApPDF')?.addEventListener('click', ()=>{
  const { jsPDF } = window.jspdf; const doc = new jsPDF();
  doc.text('Apuração mensal — Resumo', 14, 16);
  doc.setFontSize(10);
  doc.text($('#apLista').innerText || 'Sem dados', 14, 26);
  doc.text('Total: '+$('#apTotal').textContent, 14, 46);
  doc.save('apuracao.pdf');
});
$('#btnApXLSX')?.addEventListener('click', ()=>{
  const wb = XLSX.utils.book_new();
  const lines = [['Tributo','Valor'], ...$('#apLista').innerText.split('\n').map(l=>l.split(': '))];
  const ws = XLSX.utils.aoa_to_sheet(lines);
  XLSX.utils.book_append_sheet(wb, ws, 'Apuração');
  XLSX.writeFile(wb, 'apuracao.xlsx');
});

/* ===== ISS Simples ===== */
$('#btnISS')?.addEventListener('click', ()=>{
  const rbt12 = num($('#issRbt12').value);
  const rec = num($('#issReceita').value);
  const aliq = num($('#issAliq').value);
  const pd = num($('#issPD').value);
  const efet = Math.max(0, (rbt12*aliq - pd)/rbt12);
  const das = rec * efet;
  $('#issEfet').textContent = (efet*100).toFixed(2).replace('.',',')+'%';
  $('#issDas').textContent = br(das);
});
$('#btnISSPDF')?.addEventListener('click', ()=>{
  const { jsPDF } = window.jspdf; const doc = new jsPDF();
  doc.text('ISS — Simples Nacional', 14, 16);
  doc.setFontSize(10);
  doc.text('Alíquota efetiva: ' + $('#issEfet').textContent, 14, 26);
  doc.text('DAS estimado: ' + $('#issDas').textContent, 14, 34);
  doc.save('iss-simples.pdf');
});

/* ===== Parcelamento ===== */
function pricePMT(P, i, n){ i=i/100; return P * (i) / (1 - Math.pow(1+i, -n)); }
function linear(P, i, n){ i=i/100; const amort = P/n; let jurosTotal=0; for(let k=0, saldo=P; k<n; k++){ jurosTotal += saldo*i; saldo -= amort; } return {amort, jurosTotal, total:P+jurosTotal}; }
$('#btnParcPrice')?.addEventListener('click', ()=>{
  const P=num($('#parcPV').value), n=num($('#parcN').value), i=num($('#parcI').value);
  const pmt = pricePMT(P,i,n); const total = pmt*n; const juros = total - P;
  $('#parcPMT').textContent = br(pmt); $('#parcJuros').textContent = br(juros); $('#parcTotal').textContent = br(total);
});
$('#btnParcLinear')?.addEventListener('click', ()=>{
  const P=num($('#parcPV').value), n=num($('#parcN').value), i=num($('#parcI').value);
  const r = linear(P,i,n);
  $('#parcPMT').textContent = '1ª: '+br(r.amort + P*(i/100));
  $('#parcJuros').textContent = br(r.jurosTotal);
  $('#parcTotal').textContent = br(r.total);
});

/* ===== Trabalhista ===== */
$('#btnFerias')?.addEventListener('click', ()=>{
  const s=num($('#fxSal').value);
  $('#fxTotal').textContent = br(s + s/3);
});
$('#btn13')?.addEventListener('click', ()=>{
  const s=num($('#d13Sal').value), m=Math.max(0,Math.min(12, num($('#d13Meses').value)));
  $('#d13Total').textContent = br(s * (m/12));
});
$('#btnRes')?.addEventListener('click', ()=>{
  const s=num($('#resSal').value), meses=num($('#resMeses').value), dias=num($('#resDias').value);
  const saldo = s/30 * Math.max(0,dias);
  const decimo = s * ((meses%12)/12);
  const ferias = (s * ((meses%12)/12)) * (4/3); // prop + 1/3
  const fgtsMensal = s*0.08;
  const multa = (fgtsMensal*meses)*0.40;
  const total = saldo + decimo + ferias + multa;
  $('#resSaldo').textContent = br(saldo);
  $('#res13').textContent = br(decimo);
  $('#resFerias').textContent = br(ferias);
  $('#resMulta').textContent = br(multa);
  $('#resTotal').textContent = br(total);
});

/* ===== INSS (progressivo) ===== */
function inssProgressivo(sal, faixas){
  let rest = sal, ant=0, total=0;
  for(const f of faixas){
    const teto = f.ate;
    const baseFaixa = Math.max(0, Math.min(rest, teto - ant));
    total += baseFaixa * (f.aliq/100);
    ant = teto; rest = sal - teto;
    if(rest<=0) break;
  }
  return Math.max(0, total);
}
$('#btnINSS')?.addEventListener('click', ()=>{
  const faixas = [
    {ate:num($('#fa1').value), aliq:num($('#al1').value)},
    {ate:num($('#fa2').value), aliq:num($('#al2').value)},
    {ate:num($('#fa3').value), aliq:num($('#al3').value)},
    {ate:num($('#fa4').value), aliq:num($('#al4').value)},
  ];
  const sal = num($('#inssSal').value);
  $('#inssDesc').textContent = br(inssProgressivo(sal, faixas));
});

/* ===== Juros ===== */
$('#btnJS')?.addEventListener('click', ()=>{
  const P=num($('#jurosPV').value), i=num($('#jurosI').value)/100, n=num($('#jurosN').value);
  const J = P*i*n, M = P+J;
  $('#jJuros').textContent = br(J); $('#jMont').textContent = br(M);
  const ia = Math.pow(1+i,12)-1; $('#jEqAnual').textContent = (ia*100).toFixed(2).replace('.',',')+'%';
});
$('#btnJC')?.addEventListener('click', ()=>{
  const P=num($('#jurosPV').value), i=num($('#jurosI').value)/100, n=num($('#jurosN').value);
  const M = P*Math.pow(1+i,n), J = M-P;
  $('#jJuros').textContent = br(J); $('#jMont').textContent = br(M);
  const ia = Math.pow(1+i,12)-1; $('#jEqAnual').textContent = (ia*100).toFixed(2).replace('.',',')+'%';
});

/* ===== Taxa Legal ===== */
$('#btnTL')?.addEventListener('click', ()=>{
  const P=num($('#tlPV').value), sel=num($('#tlSELIC').value)/100, ipca=num($('#tlIPCA').value)/100;
  const tl = Math.max(0, sel - ipca);
  const juros = P*tl, mont = P+juros;
  $('#tlTx').textContent = (tl*100).toFixed(2).replace('.',',')+'%';
  $('#tlJuros').textContent = br(juros);
  $('#tlMont').textContent = br(mont);
});

/* ===== IRRF ===== */
function parseTabelaIRRF(){
  const ids=['t1','t2','t3','t4','t5'];
  const linhas=[];
  ids.forEach(id=>{
    const [ate, aliq, parc] = $('#'+id).value.split(',').map(x=>Number(x.trim()));
    linhas.push({ate, aliq:aliq/100, parc});
  });
  return linhas.sort((a,b)=>a.ate-b.ate);
}
function irrfCalcular(){
  const sal = num($('#irrfSal').value);
  const inss = num($('#irrfINSS').value);
  const deps = num($('#irrfDeps').value);
  const depVal = num($('#irrfDepVal').value);
  const outras = num($('#irrfOtrs').value);
  const simpl = num($('#irrfSimpl').value);
  let base = Math.max(0, sal - inss - deps*depVal - outras - simpl);
  const tab = parseTabelaIRRF();
  let faixa = tab.find(t=> base <= t.ate ) || tab[tab.length-1];
  const imposto = Math.max(0, base*faixa.aliq - faixa.parc);
  $('#irrfBase').textContent = br(base);
  $('#irrfAli').textContent = (faixa.aliq*100).toFixed(2).replace('.',',')+'%';
  $('#irrfParc').textContent = br(faixa.parc);
  $('#irrfDue').textContent = br(imposto);
  return {base, faixa, imposto};
}
$('#btnIRRF')?.addEventListener('click', ()=>{
  if(!canSim()) return; if(!consumeSim()) return;
  irrfCalcular();
});
$('#btnIRRFPDF')?.addEventListener('click', ()=>{
  const { jsPDF } = window.jspdf; const doc = new jsPDF();
  const r = irrfCalcular();
  doc.text('IRRF — Cálculo Mensal', 14, 16);
  doc.setFontSize(10);
  doc.text('Base: ' + $('#irrfBase').textContent, 14, 26);
  doc.text('Alíquota: ' + $('#irrfAli').textContent + '  |  Parcela: ' + $('#irrfParc').textContent, 14, 34);
  doc.text('IRRF devido: ' + $('#irrfDue').textContent, 14, 42);
  doc.save('irrf.pdf');
});

/* ===== Qualidade de vida ===== */
document.addEventListener('keydown', (e)=>{
  if(e.key==='/' && !/input|textarea|select/i.test(document.activeElement.tagName)){
    e.preventDefault();
    $('#topnav [data-nav]')?.focus();
  }
});
</script>
